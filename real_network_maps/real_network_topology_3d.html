<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Network Topology Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body { margin: 0; background: #f0f0f0; }
        #viewer { width: 100vw; height: 100vh; }
        #info { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.8); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="viewer"></div>
    <div id="info">
        <h3>Network Topology Viewer</h3>
        <p>Devices: 9 | Connections: 8</p>
        <p>Use mouse to orbit, zoom, and pan</p>
    </div>

    <script>
        // Topology data
        const devices = [
  {
    "id": "cloud",
    "label": "Internet",
    "type": "cloud",
    "x": 0.0,
    "y": 0.0,
    "z": -20.0,
    "model3d": "assets/models/device_generic.glb",
    "device_type": "client",
    "icon": "assets/icons/device_generic.svg",
    "processed_at": "real_data",
    "processing_version": "integrated-v1.0",
    "data_source": "network_map_3d",
    "position_2d": {
      "x": 0.0,
      "y": 0.0
    }
  },
  {
    "id": "fg1",
    "label": "Fortigate Firewall",
    "mac": "00:09:18:11:22:33",
    "x": 0.0,
    "y": 0.0,
    "z": -5.0,
    "device_type": "firewall",
    "icon": "assets/icons/fortigate.svg",
    "model3d": "assets/models/fortinet/FG-600E.glb",
    "processed_at": "real_data",
    "processing_version": "integrated-v1.0",
    "data_source": "network_map_3d",
    "position_2d": {
      "x": 0.0,
      "y": 0.0
    }
  },
  {
    "id": "fg2",
    "label": "FORTIGATE",
    "mac": "00:09:18:44:55:66",
    "x": 5.0,
    "y": 0.0,
    "z": -5.0,
    "device_type": "firewall",
    "icon": "assets/icons/fortigate.svg",
    "model3d": "assets/models/fortinet/FG-600E.glb",
    "processed_at": "real_data",
    "processing_version": "integrated-v1.0",
    "data_source": "network_map_3d",
    "position_2d": {
      "x": 5.0,
      "y": 0.0
    }
  },
  {
    "id": "sw1",
    "label": "Switch",
    "mac": "00:09:1A:11:22:33",
    "x": 0.0,
    "y": 0.0,
    "z": -10.0,
    "device_type": "switch",
    "icon": "assets/icons/fortiswitch.svg",
    "model3d": "assets/models/fortinet/FS-148E.glb",
    "processed_at": "real_data",
    "processing_version": "integrated-v1.0",
    "data_source": "network_map_3d",
    "position_2d": {
      "x": 0.0,
      "y": 0.0
    }
  },
  {
    "id": "ap1",
    "label": "FortiAP",
    "mac": "F4:6D:04:11:22:33",
    "x": 0.0,
    "y": 0.0,
    "z": -15.0,
    "device_type": "access_point",
    "icon": "assets/icons/fortiap.svg",
    "model3d": "assets/models/fortinet/FAP-432F.glb",
    "processed_at": "real_data",
    "processing_version": "integrated-v1.0",
    "data_source": "network_map_3d",
    "position_2d": {
      "x": 0.0,
      "y": 0.0
    }
  },
  {
    "id": "wd1",
    "label": "Desktop PC 1",
    "x": 5.0,
    "y": 0.0,
    "z": -20.0,
    "device_type": "client",
    "icon": "assets/icons/device_generic.svg",
    "model3d": "assets/models/device_generic.glb",
    "processed_at": "real_data",
    "processing_version": "integrated-v1.0",
    "data_source": "network_map_3d",
    "position_2d": {
      "x": 5.0,
      "y": 0.0
    }
  },
  {
    "id": "wd2",
    "label": "Desktop PC 2",
    "x": 10.0,
    "y": 0.0,
    "z": -20.0,
    "device_type": "client",
    "icon": "assets/icons/device_generic.svg",
    "model3d": "assets/models/device_generic.glb",
    "processed_at": "real_data",
    "processing_version": "integrated-v1.0",
    "data_source": "network_map_3d",
    "position_2d": {
      "x": 10.0,
      "y": 0.0
    }
  },
  {
    "id": "wld1",
    "label": "Laptop 1",
    "x": 15.0,
    "y": 0.0,
    "z": -20.0,
    "model3d": "assets/models/laptop.glb",
    "device_type": "client",
    "icon": "assets/icons/device_generic.svg",
    "processed_at": "real_data",
    "processing_version": "integrated-v1.0",
    "data_source": "network_map_3d",
    "position_2d": {
      "x": 15.0,
      "y": 0.0
    }
  },
  {
    "id": "wld2",
    "label": "Mobile Phone",
    "x": 20.0,
    "y": 0.0,
    "z": -20.0,
    "model3d": "assets/models/laptop.glb",
    "device_type": "client",
    "icon": "assets/icons/device_generic.svg",
    "processed_at": "real_data",
    "processing_version": "integrated-v1.0",
    "data_source": "network_map_3d",
    "position_2d": {
      "x": 20.0,
      "y": 0.0
    }
  }
];
        const connections = [
  [
    "cloud",
    "fg1"
  ],
  [
    "fg1",
    "fg2"
  ],
  [
    "fg2",
    "sw1"
  ],
  [
    "fg2",
    "ap1"
  ],
  [
    "sw1",
    "wd1"
  ],
  [
    "sw1",
    "wd2"
  ],
  [
    "ap1",
    "wld1"
  ],
  [
    "ap1",
    "wld2"
  ]
];
        const layout = {
  "positions": {
    "cloud": {
      "x": -675.0,
      "y": 0,
      "z": 1.8866762695231927,
      "layer": "access"
    },
    "fg1": {
      "x": -525.0,
      "y": 0,
      "z": -23.774219158342646,
      "layer": "access"
    },
    "fg2": {
      "x": -375.0,
      "y": 0,
      "z": 32.18992816197762,
      "layer": "access"
    },
    "sw1": {
      "x": -225.0,
      "y": 0,
      "z": 3.53734568109806,
      "layer": "access"
    },
    "ap1": {
      "x": -75.0,
      "y": 0,
      "z": -9.202729981135008,
      "layer": "access"
    },
    "wd1": {
      "x": 75.0,
      "y": 0,
      "z": -2.7189861071259287,
      "layer": "access"
    },
    "wd2": {
      "x": 225.0,
      "y": 0,
      "z": 38.68640442779251,
      "layer": "access"
    },
    "wld1": {
      "x": 375.0,
      "y": 0,
      "z": -40.713178756976,
      "layer": "access"
    },
    "wld2": {
      "x": 525.0,
      "y": 0,
      "z": -15.382349386910143,
      "layer": "access"
    }
  },
  "layers": [
    "access"
  ],
  "dimensions": {
    "width": 1350,
    "height": 200,
    "depth": 100
  }
};

        // Three.js scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(200, 200, 200);

        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('viewer').appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(100, 100, 50);
        scene.add(directionalLight);

        // Add devices
        const deviceGeometry = new THREE.BoxGeometry(10, 10, 10);
        const deviceMaterial = new THREE.MeshLambertMaterial({ color: 0x4a90e2 });

        devices.forEach((device, index) => {
            const pos = layout.positions ? layout.positions[device.id] : {x: index * 50, y: 0, z: 0};

            const mesh = new THREE.Mesh(deviceGeometry, deviceMaterial);
            mesh.position.set(pos.x || 0, pos.y || 0, pos.z || 0);
            mesh.userData = device;
            scene.add(mesh);

            // Add label
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            context.font = '24px Arial';
            context.fillStyle = 'rgba(255,255,255,1)';
            context.fillText(device.name, 0, 24);

            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.position.set(pos.x || 0, pos.y + 20 || 20, pos.z || 0);
            scene.add(sprite);
        });

        // Add connections
        connections.forEach(connection => {
            const sourcePos = layout.positions ? layout.positions[connection.source] : {x: 0, y: 0, z: 0};
            const targetPos = layout.positions ? layout.positions[connection.target] : {x: 100, y: 0, z: 0};

            const points = [
                new THREE.Vector3(sourcePos.x || 0, sourcePos.y || 0, sourcePos.z || 0),
                new THREE.Vector3(targetPos.x || 0, targetPos.y || 0, targetPos.z || 0)
            ];

            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            const material = new THREE.LineBasicMaterial({ color: 0x666666, linewidth: 2 });
            const line = new THREE.Line(geometry, material);
            scene.add(line);
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>